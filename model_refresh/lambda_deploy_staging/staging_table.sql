CREATE TABLE prod_db.adhoc.ACH_DS_ENGINE_STAGING AS
WITH random_businesses AS (
    SELECT business_id,
           ROW_NUMBER() OVER (ORDER BY RANDOM()) AS rn
    FROM "PROD_DB"."DATA"."ACH_DS_ENGINE_PROD"
    QUALIFY rn <= 13
),
replacement_ids AS (
    SELECT column1 AS new_id,
           ROW_NUMBER() OVER (ORDER BY SEQ4()) AS rn
    FROM VALUES
        ('37b09bb8-8777-47b8-91c9-05695cb7f9d2'),
        ('efbedf22-1bd4-486c-ad0b-ace2e4e80dc1'),
        ('db5b9c3e-068c-4210-916f-017820824172'),
        ('d97ff267-d496-4154-a6e1-a980337bd88a'),
        ('6b1b358c-9ce2-4770-a652-5eaa4a59e399'),
        ('267c4c56-ee5f-42ce-a207-48f42465a59b'),
        ('a1b09f2a-b00c-4623-9ff9-2f43a8ec02d1'),
        ('65b0fd4c-c4a7-43ff-b29c-2ee30fa79f29'),
        ('1b8c7973-e479-44e0-80dc-8d9bcdfe08cd'),
        ('48502dcf-74f3-48c2-ba58-8037b426972c'),
        ('332af2d3-0e0d-4b26-aa50-2fa0095763f0'),
        ('f4e3c547-3797-4198-8d18-89f6f3979464'),
        ('119da62a-5917-413e-9d12-14d6a5d42301')
),
paired AS (
    SELECT rb.business_id AS old_id, ri.new_id
    FROM random_businesses rb
    JOIN replacement_ids ri ON rb.rn = ri.rn
)
SELECT a.new_id as business_id, MOB,EIN_SSN,PAST30D_AVG_ACH_AMOUNT,REJECTED_PAST30D_AVG_ACH_AMOUNT,
RETURNED_PAST30D_AVG_ACH_AMOUNT,PAST30D_ACH_COUNT,PAST30D_RETURNED_ACH,PAST30D_REJECTED_ACH,
AVG_RUNNING_BALANCE_PAST30D,RB_AT_DEPOSIT,STDDEV_RUNNING_BALANCE_PAST30D,OD_COUNT_PAST30D,
ZERO_BALANCE_COUNT_PAST30D,CARD_TXN_COUNT_PAST2D,CARD_TXN_MEDIAN_PAST2D,CARD_TXN_AVG_PAST2D,
ACH_C_COUNT_PAST2D,ACH_C_MEDIAN_PAST2D,ACH_C_AVG_PAST2D,ACH_C_STD_PAST2D,DEBIT_BY_CREDIT_PAST_2D,
DEBIT_TXN_COUNT_PAST2D,ACH_D_MEDIAN_PAST2D,ACH_D_AVG_PAST2D,CARD_TXN_COUNT_PAST10D,
CARD_TXN_MEDIAN_PAST10D,CARD_TXN_AVG_PAST10D,ACH_C_COUNT_PAST10D,ACH_C_MEDIAN_PAST10D,
ACH_C_AVG_PAST10D,ACH_C_STD_PAST10D,DEBIT_BY_CREDIT_PAST_10D,DEBIT_TXN_COUNT_PAST10D,
ACH_D_MEDIAN_PAST10D,ACH_D_AVG_PAST10D,CARD_TXN_COUNT_PAST30D,CARD_TXN_MEDIAN_PAST30D,
CARD_TXN_AVG_PAST30D,ACH_C_COUNT_PAST30D,ACH_C_MEDIAN_PAST30D,ACH_C_AVG_PAST30D,ACH_C_STD_PAST30D,
DEBIT_BY_CREDIT_PAST_30D,DEBIT_TXN_COUNT_PAST30D,ACH_D_MEDIAN_PAST30D,ACH_D_AVG_PAST30D,
ACH_C_COUNT_PAST10BY30D,DEBIT_TXN_COUNT_PAST10BY30D,ACH_C_MEDIAN_PAST10BY30D,
CARD_TXN_MEDIAN_PAST10BY30D,ACH_C_AVG_PAST10BY30D,RUN_TIME
FROM paired a inner join "PROD_DB"."DATA"."ACH_DS_ENGINE_PROD" b
on a.old_id = b.business_id

UNION 
select * from "PROD_DB"."DATA"."ACH_DS_ENGINE_PROD"
